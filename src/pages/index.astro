---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import ExpertiseGrid from '../components/ExpertiseGrid.astro';
import StackClusters from '../components/StackClusters.astro';
import ExperienceTimeline from '../components/ExperienceTimeline.astro';
import BlogPreview from '../components/BlogPreview.astro';
import DocsPreview from '../components/DocsPreview.astro';

const posts = (await getCollection('blog', ({ data }) => !data.draft)).sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);
const latestPosts = posts.slice(0, 3);

const docs = (await getCollection('docs', ({ data }) => !data.draft)).sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);
const featuredDocs = docs.filter((doc) => doc.data.featured).slice(0, 3);
const docsForPreview = featuredDocs.length > 0 ? featuredDocs : docs.slice(0, 3);
const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
---

<BaseLayout
  title="Aman Karn | Senior Odoo Integration Engineer"
  description="Personal engineering portfolio focused on Odoo integrations, backend reliability, and integration architecture."
>
  <Hero />

  <section class="trust-strip" aria-label="Trust areas">
    <p>Idempotent Integrations</p>
    <p>Webhook-Driven Systems</p>
    <p>Queue-Orchestrated Workflows</p>
    <p>Production Observability</p>
  </section>

  <ExpertiseGrid />
  <StackClusters />
  <ExperienceTimeline />
  <BlogPreview posts={latestPosts} />
  <DocsPreview docs={docsForPreview} />

  <section class="contact-cta">
    <p class="section-label">Contact</p>
    <h2>Available for ERP Integration & Backend Architecture Roles</h2>
    <p>Available for backend integration roles and ERP architecture projects.</p>
    <a class="btn btn-primary" href={`${base}contact/`}>Get in touch</a>
  </section>
</BaseLayout>
