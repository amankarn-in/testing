---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const docs = (await getCollection('docs', ({ data }) => !data.draft)).sort((a, b) => {
  const categorySort = a.data.category.localeCompare(b.data.category);
  return categorySort !== 0
    ? categorySort
    : b.data.pubDate.getTime() - a.data.pubDate.getTime();
});
const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const toSlug = (id: string) => id.replace(/\.(md|mdx)$/i, '');
---

<BaseLayout title="Docs | Senior Odoo Integration Engineer" description="Technical documentation for Odoo integration architecture, connector patterns, and operational reliability." enableMermaid>
  <section>
    <p class="section-label">Docs</p>
    <h1>Integration documentation and implementation playbooks.</h1>
  </section>

  <section class="feature-grid docs-grid">
    {
      docs.map((doc) => (
        <article class="surface-card">
          <p class="meta-line">{doc.data.category}</p>
          <h2><a href={`${base}docs/${toSlug(doc.id)}/`}>{doc.data.title}</a></h2>
          <p>{doc.data.description}</p>
          <div class="chip-row">
            {doc.data.tags.map((tag) => <span class="chip">{tag}</span>)}
          </div>
        </article>
      ))
    }
  </section>
</BaseLayout>
